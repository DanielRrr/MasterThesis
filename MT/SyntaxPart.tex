\section{Модальное $\lambda$-исчисление, основанное на исчислении IEL$^{-}$}

Определим натуральное исчисление для IEL$^{-}$ :

\begin{defin} Hатуральное исчисление NIEL$^{-}$ для интуиционистской эпистемической логики IEL$^{-}$ -- это
расширение натурального исчисления для интуиционистской логики высказываний с добавлением следующих правил вывода для модальности:

\begin{minipage}{0.5\textwidth}
  \begin{flushleft}
  \begin{prooftree}
    \AxiomC{$\Gamma \vdash A$}
    \RightLabel{$\Box_I$}
    \UnaryInfC{$\Gamma \vdash \Box A$}
\end{prooftree}
  \end{flushleft}
\end{minipage}
\begin{minipage}{0.5\textwidth}
  \begin{flushright}
  \begin{prooftree}
  \AxiomC{$\Gamma \vdash \Box A_1, \dots, \Gamma \vdash \Box A_n $}
  \AxiomC{$A_1,\dots,A_n \vdash B$}
  \BinaryInfC{$\Gamma \vdash \Box B$}
  \end{prooftree}
  \end{flushright}
\end{minipage}
\end{defin}

Первое правило позволяет выводить ко-рефлексию. Второе модальное правило -- это аналог для правила $\Box_I$
в натуральном исчислении для конструктивной K (see \cite{ModalLa}) без $\Diamond$.

Мы будем обозначать $\Gamma \vdash \Box A_1, \dots, \Gamma \vdash \Box A_n$ и $A_1,\dots,A_n \vdash B$ соответственно как $\Gamma \vdash {\bf K} \vec{A}$ и $\vec{A} \vdash B$ для краткости.

\vspace{\baselineskip}

\begin{lemma}
  $\Gamma \vdash_{\text{NIEL}^{-}} A \Rightarrow$ IEL$^{-} \vdash \bigwedge \Gamma \rightarrow A$.
\end{lemma}

\begin{proof}
Индукция по построению вывода. Рассмотрим модальные случаи.

\vspace{\baselineskip}

1) Если $\Gamma \vdash_{\text{NIEL}^{-}} A$, тогда $\text{IEL}^{-} \vdash \bigwedge \Gamma \rightarrow \Box A$.

$\begin{array}{lll}
(1) & \bigwedge \Gamma \rightarrow A & \text{предположение индукции}\\
(2) & A \rightarrow \Box A &\text{ко-рефлексия}\\
(3) & (\bigwedge \Gamma \rightarrow A) \rightarrow ((A \rightarrow \Box A) \rightarrow (\bigwedge \Gamma \rightarrow \Box A))&\text{теорема IEL$^{-}$}\\
(4) & (A \rightarrow \Box A) \rightarrow (\bigwedge \Gamma \rightarrow \Box A) &\text{из (1), (3) и MP}\\
(5) & \bigwedge \Gamma \rightarrow \Box A &\text{из (2), (4) и MP}\\
\end{array}$

\vspace{\baselineskip}

2) Если $\Gamma \vdash_{\text{NIEL}^{-}} \Box \vec{A}$ и $\vec{A} \vdash B$, то $\text{IEL}^{-} \vdash \bigwedge \Gamma \rightarrow \Box B$.

$\begin{array}{lll}
(1) &\bigwedge \Gamma \rightarrow \bigwedge \limits_{i = 1}^{n} \Box A_i & \text{предположение индукции} \\
(2) &\bigwedge \limits_{i = 1}^{n} \Box A_i \rightarrow \Box \bigwedge \limits_{i = 1}^{n} A_i& \text{теорема IEL$^{-}$} \\
(3) &\bigwedge \Gamma \rightarrow \Box \bigwedge \limits_{i = 1}^{n} A_i & \text{по (1), (2) и правилу силлогизма} \\
(4) &\bigwedge \limits_{i = 1}^{n} A_i \rightarrow B& \text{предположение индукции} \\
(5) &(\bigwedge \limits_{i = 1}^{n} A_i \rightarrow B) \rightarrow \Box (\bigwedge \limits_{i = 1}^{n} A_i \rightarrow B)& \text{ко-рефлексия}\\
(6) &\Box (\bigwedge \limits_{i = 1}^{n} A_i \rightarrow B)& \text{из (4), (5) и MP} \\
(7) &\Box \bigwedge \limits_{i = 1}^{n} A_i \rightarrow \Box B & \text{по (6) и по нормальности} \\
(8) &\bigwedge \Gamma \rightarrow \Box B & \text{по (3), (7) и правилу силлогизма}
\end{array}$

\end{proof}

\begin{lemma}
$ $
Если $\text{IEL}^{-} \vdash A$, то $\text{NIEL}^{-} \vdash A$.
\end{lemma}

\begin{proof}
Построение выводов для модальных аксиом в $\text{NIEL}^{-}$. Мы рассмотрим эти выводы ниже с использованием термов.
\end{proof}

\vspace{\baselineskip}

Далее мы построим типизированное $\lambda$-исчисление по фрагменту NIEL$^{-}$ с правилами для импликации, конъюнкции и модальности.
Данный фрагмент экивалентен IEL$^{-}$ без аксиом для отрицания и дизъюнкции, что элементарно проверяется аналогично.

Определим термы и типы:

\vspace{\baselineskip}

\begin{defin} Множество термов:

Пусть $\mathbb{V}$ счетное множество переменных. Термы $\Lambda_{{\bf K}}$ порождается следующей грамматикой:

$\begin{array}{lll}
& \Lambda_{{\bf K}} ::= \mathbb{V} \: | \:  (\lambda \mathbb{V}.\Lambda_{{\bf K}}) \: | \: (\Lambda_{{\bf K}}\Lambda_{{\bf K}}) \: | \: (\Lambda_{{\bf K}} , \Lambda_{{\bf K}}) \: | \: (\pi_1 \Lambda_{{\bf K}}) \: | \: (\pi_2 \Lambda_{{\bf K}}) \: | & \\
& \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad ({\bf pure \: } \: \Lambda_{{\bf K}}) \: | \: ({\bf let \: pure \:} \mathbb{V}^{*} = \Lambda_{{\bf K}}^{*} {\: \bf in \:} \Lambda_{{\bf K}})
\end{array}$

\end{defin}

Где $\mathbb{V}^{*}$ и $\Lambda_{{\bf K}}^{*}$ обозначают множество всех конечных последовательностей переменных $\bigcup \limits_{i=0}^{\infty} \mathbb{V}^i$
и множество всех конечных последовательностей термов $\bigcup \limits_{i = 0}^{\infty} {\Lambda_{{\bf K}}}^i $. Последовательность переменных $\vec{x}$ и последовательность термов $\vec{M}$ в терме вида ${\bf let \: pure \:}$ должны иметь одинаковую длину.
Иначе терм не будет правильно построенным.

\begin{defin} Множество типов:

Пусть $\mathbb{T}$ -- это счетное множество атормарных типов. Типы $\mathbb{T}_{{\bf K}}$ с типовым оператором $\Box$ порождаются следующей грамматикой:
\begin{equation}
  \mathbb{T}_{{\bf K}} ::= \mathbb{T} \: | \: (\mathbb{T}_{{\bf K}} \to \mathbb{T}_{{\bf K}}) \: |
  \: (\mathbb{T}_{{\bf K}} \times \mathbb{T}_{{\bf K}}) \: | \: (\Box \mathbb{T}_{{\bf K}})
\end{equation}
\end{defin}

Контекст, его домен и кодомен определены стандартно \cite{Neder}\cite{Morten}.

Наша система состоит из следующих правил типизации в стиле Карри:

\begin{defin} Модальное $\lambda$-исчисление, основанное на исчислении IEL$^{-}$:

  \begin{center}
  \begin{prooftree}
  \AxiomC{$ $}
  \RightLabel{\scriptsize{ax}}
  \UnaryInfC{$\Gamma , x : A \vdash x : A$}
  \end{prooftree}
  \end{center}

  \begin{minipage}{0.45\textwidth}
    \begin{prooftree}
    \AxiomC{$\Gamma, x : A \vdash M : B$}
    \RightLabel{$\rightarrow_i$}
    \UnaryInfC{$\Gamma \vdash \lambda x. M : A \to B$}
    \end{prooftree}

    \begin{prooftree}
    \AxiomC{ $\Gamma \vdash M : A$ }
    \AxiomC{ $\Gamma \vdash N : B$ }
    \RightLabel{$\times_i$}
    \BinaryInfC{$\Gamma \vdash \langle M, N \rangle : A \times B$}
    \end{prooftree}

    \begin{prooftree}
      \AxiomC{$\Gamma \vdash M : A$}
      \RightLabel{$\Box_I$}
      \UnaryInfC{$\Gamma \vdash {\bf pure \: } \: M : {\bf K}A $}
    \end{prooftree}
\end{minipage}%
\hfill
\begin{minipage}{0.45\textwidth}
\begin{tabular}{p{\textwidth}}
  \begin{prooftree}
  \AxiomC{$\Gamma \vdash M : A \to B$}
  \AxiomC{$\Gamma \vdash N : A$}
  \RightLabel{$\rightarrow_e$}
  \BinaryInfC{$\Gamma \vdash MN : B$}
  \end{prooftree}

  \begin{prooftree}
  \AxiomC{ $\Gamma \vdash M : A_1 \times A_2$ }
  \RightLabel{$\times_e$, $i \in \{ 1, 2 \}$}
  \UnaryInfC{$\Gamma \vdash \pi_i M : A_i$}
  \end{prooftree}

  \begin{prooftree}
    \AxiomC{$\Gamma \vdash \vec{M} : \Box \vec{A}$}
    \AxiomC{$\vec{x} : \vec{A} \vdash N : B$}
    \RightLabel{$\text{let}_{\Box}$}
    \BinaryInfC{$\Gamma \vdash {\bf let \: pure \:} \vec{x} = \vec{M} {\: \bf in \: } N : \Box B$}
  \end{prooftree}
\end{tabular}
\end{minipage}%

\end{defin}

Правило типизации $\Box$ аналогично правилу $\bigcirc_I$ в монадическом метаязыке \cite{Lax}.

$\Box_I$ позволяет вкладывать объект типа $A$ в текущиц вычислительный контекст, изменяя его тип на $\Box A$.

Правило типизации $\text{let}_{\Box}$ аналогично правилу $\Box$-правилу в модальном $\lambda$-исчислении
для интуционистской минимальной нормальной модальной логики {\bf IK} \cite{ModalK}.

$\Gamma \vdash \vec{M} : \Box \vec{A}$ -- это синтаксический сахар для $\Gamma \vdash M_1 : \Box A_1,\dots,\Gamma \vdash M_n : \Box A_n$ и
$\vec{x} : \vec{A} \vdash N : B$ -- это краткая форма для $x_1 : A_1, \dots, x_n : A_n \vdash N : B$.
${\bf let \: pure \:} \vec{x} = \vec{M} {\: \bf in \: } N$ -- это мгновенное локальное связывание в терме $N$.
Мы будем использовать такую краткую форму вместо ${\bf let \: pure\:} x_1,\dots,x_n = M_1,\dots,M_n {\: \bf in \:} N$.

\vspace{\baselineskip}

Примеры выводов:

\begin{prooftree}
\AxiomC{$x : A \vdash x : A$}
\UnaryInfC{$x : A \vdash {\bf pure \:} x : \Box A$}
\UnaryInfC{$\vdash (\lambda x. {\bf pure \: } x) : A \to \Box A$}
\end{prooftree}

\begin{prooftree}
\AxiomC{$f : \Box (A \to B) \vdash f : \Box (A \to B)$}
\AxiomC{$x : \Box A \vdash x : \Box A $}
\AxiomC{$g : A \to B \vdash g : A \to B$}
\AxiomC{$y : A \vdash y : A$}
\RightLabel{$\to_e$}
\BinaryInfC{$g : A \to B, y : A \vdash g y : B$}
\RightLabel{$\text{let}_{{\bf K}}$}
\TrinaryInfC{$f : \Box (A \to B), x : \Box A \vdash {\bf let \: pure \:} g, y  = f, x {\: \bf in \:} g y : \Box B$}
\UnaryInfC{$f : \Box (A \to B) \vdash \lambda x. {\bf let \: pure\:} g, y = f, x {\: \bf in \:} g y : \Box A \to \Box B$}
\UnaryInfC{$\vdash \lambda f. \lambda x. {\bf let \:pure \:} g, y = f, x {\: \bf in \:} g y : \Box(A \to B) \to \Box A \to \Box B$}
\end{prooftree}

\vspace{\baselineskip}

Определим свободные переменные, подставновку, $\beta$-редукцию и $\eta$-редукцию. Многошаговая $\beta$-редукция и $\beta \eta$-эквивалентность определены стандартно:

\begin{defin} Множество свободных переменных $FV(M)$ для произвольного терма $M$:

1) $FV(x) = \{ x \}$;

2) $FV(\lambda x. M) = FV(M) \setminus \{ x\}$;

3) $FV(M N) = FV(M) \cup FV(N);$

4) $FV(\langle M,N \rangle) = FV(M) \cup FV(N)$;

5) $FV(\pi_i M) \subseteq FV(M)$, $i \in \{ 1, 2\}$;

6) $FV(\text{pure } M) = FV(M)$;

7) $FV({\bf let \: pure} \: \vec{x} = \vec{M} \:\: {\bf in} \:\: N) = \bigcup \limits_{i = 1}^n FV(M), \text{где $n = |\vec{M}|$}$.
\end{defin}

Во избежание лишних коллизий мы будем полагать, что если терм вида ${\bf let \: pure \:} x = ({\bf let \: pure \:} \vec{y} = \vec{N} {\: \bf in \:} P) {\: \bf in \:} M$
типизируется, то $x$ не содержится в $\vec{y}$, то есть последовательное применение локальных связываний требует на каждом шаге различныx переменныx.

\begin{defin} Подстановка:

1) $x [x := N] = N$, $x [y := N] = x$;

2) $(M N) [x := N] = M[x := N] N [x := N]$;

3) $(\lambda x. M) [x := N] = \lambda x. M [y := N]$, $y \in FV(M)$;

4) $(M, N)[x := P] = (M[x := P], N [x := P])$;

5) $(\pi_i M) [x := P] = \pi_i (M[x := P])$, $i \in \{ 1, 2\}$;

6) $({\bf pure \: } M) [x := P] = {\bf pure \: } (M [x := P])$;

7) $({\bf let \: pure \:}\vec{x} = \vec{M} {\: \bf in \:} N) [y := P] = {\bf let \: pure \:} \vec{x} = (\vec{M} [y := P]) {\: \bf in \:} N$.
\end{defin}


\begin{defin} Правила $\beta$-редукции и $\eta$-редукции:

1) $(\lambda x. M) N \rightarrow_{\beta} M [x := N]$;

2) $\pi_1 \langle M, N \rangle \rightarrow_{\beta} M$;

3) $\pi_2 \langle M, N \rangle \rightarrow_{\beta} N$;

4) $\begin{array}{lll}
& {\bf let \: pure \:} \vec{x}, y, \vec{z} = \vec{M}, {\bf let \: pure \: } \vec{w} = \vec{N} {\: \bf in \: } Q, \vec{P} {\: in \:} R \rightarrow_{\beta \Box} & \\
& {\bf let \: pure \:} \vec{x}, \vec{w}, \vec{z} = \vec{M}, \vec{N}, \vec{P} {\: \bf in \: } R [y := Q]
\end{array}$

5) ${\bf let \: pure \:} \vec{x} = {\bf pure \:} \vec{M} {\: \bf in \:} N \rightarrow_{\beta \Box {\bf pure}} {\bf pure \:} N [\vec{x} := \vec{M}]$

6) ${\bf let \: pure \:} \underline{\quad} = \underline{\quad} {\: \bf in \:} M \rightarrow_{\beta {\bf nec}} {\bf pure \:} M$, где \underline{\quad} -- это пустая последовательность термов.

7) $\lambda x. f x \rightarrow_{\eta} f$;

8) $\langle \pi_1 P, \pi_2 P \rangle \rightarrow_{\eta} P$;

9) ${\bf let \: pure \:} x = M {\: \bf in \: } x \rightarrow_{\Box id} M$;

\end{defin}

Мы будет писать $M \rightarrow_{r} N$, если терм $M$ редуцируется к терму $N$ по одному из перечисленных выше правил.

По умолчанию мы используем стратегию вычисления с вызовом по имени.

Докажем стандартные леммы о контекстах \footnote{Мы не будем рассматривать случаи для стандартных связок, так как они уже доказаны для просто типизированного $\lambda$-исчисления \cite{Neder} \cite{Morten}. Мы будем рассматривать только модальные случаи}:

\begin{lemma} Инверсия отношения типизации ${\Box}_I$.

Пусть $\Gamma \vdash {\bf pure \:} M : \Box A$, тогда $\Gamma \vdash M : A$;
\end{lemma}

\begin{proof}
Очевидно.
\end{proof}

\begin{lemma} Базовые леммы.

\begin{itemize}
\item Если $\Gamma \vdash M : A$ и $\Gamma \subseteq \Delta$, тогда $\Delta \vdash M : A$;
\item Если $\Gamma \vdash M : A$, тогда $\Delta \vdash M : A$, где $\Delta = \{ x_i : A_i \: | \: (x_i : A_i) \in \Gamma \: \& \: x_i \in FV(M) \}$
\item Если $\Gamma, x : A \vdash M : B$ и $\Gamma \vdash N : A$, где $\Gamma \vdash M [x := N] : B$.
\end{itemize}
\end{lemma}

Рассмотрим случаи для правила $\text{let}_{\Box}$.

\begin{proof}
$ $

1) Пусть вывод заканчивается следующим правилом:

\begin{prooftree}
\AxiomC{$\Gamma \vdash \vec{M} : \Box \vec{A}$}
\AxiomC{$\vec{x} : \vec{A} \vdash N : B$}
\RightLabel{$\text{let}_{\Box}$}
\BinaryInfC{$\Gamma \vdash {\bf let \: pure \:} \vec{x} = \vec{M} {\: \bf in \: } N : \Box B$}
\end{prooftree}

По предположению индукции $\Delta \vdash \vec{M} : {\bf K} \vec{A}$, тогда $\Delta \vdash {\bf let \: pure \:} \vec{x} = \vec{M} {\: \bf in \: } N : \Box B$.

\vspace{\baselineskip}

Случаи 2)--3) рассматриваются аналогично.

\end{proof}

\begin{theorem} Редукция субъекта

Если $\Gamma \vdash M : A$ и $M \twoheadrightarrow_{\beta \eta} N$, тогда $\Gamma \vdash N : A$

\end{theorem}

\begin{proof}

Индукция по выводу $\Gamma \vdash M : A$ и по порождению $\rightarrow_{\beta \eta}$.

Случаи с функцией и парами рассмотрены здесь \cite{Morten} \cite{Pierce}.

1) Если $\Gamma \vdash {\bf let \: pure \:} \vec{x}, y, \vec{z} = \vec{M}, {\bf let \: pure \: } \vec{w} = \vec{N} {\bf \: in \: } Q, \vec{P}  {\: \bf in \:} R : \Box B$,
тогда $\Gamma \vdash {\bf let \: pure \:} \vec{x}, \vec{w}, \vec{z} = \vec{M}, \vec{N}, \vec{P} \: { \bf in } \: R [y := Q] : \Box B$ по правилу 4).

2) Если $\Gamma \vdash {\bf let \: pure \:} x = M {\: \bf in \: } x : \Box A$, тогда $\Gamma \vdash M : {\bf K}A$ по правилу 9).

Рассмотрено здесь \cite{ModalK}.

3) Пусть вывод заканчивается применением следующего правила

\begin{prooftree}
\AxiomC{$\Gamma \vdash {\bf pure \:} \vec{M} : \Box \vec{A}$}
\AxiomC{$\vec{x} : \vec{A} \vdash N : B$}
\BinaryInfC{$\Gamma \vdash {\bf let \: pure \:} \vec{x} = {\bf pure \:} \vec{M} {\: \bf in \:} N : \Box B$}
\end{prooftree}

Тогда $\Gamma \vdash \vec{M} : \vec{A}$ по инверсии отношения типизации для $\Box_I$ и $\Gamma \vdash N [\vec{x} := \vec{M}] : B$ по лемме 4, часть 3.

Тогда мы можем преобразовать данный вывод в следующий:

\begin{prooftree}
\AxiomC{$\Gamma \vdash N [\vec{x} := \vec{M}] : B$}
\RightLabel{$\Box_I$}
\UnaryInfC{$\Gamma \vdash {\bf pure \:} N [\vec{x} := \vec{M}] : \Box B$}
\end{prooftree}

4) Пусть вывод заканчивается применением правила ${\text let}_{\Box}$ для типового объявления, выводимого из пустого контекста:

\begin{prooftree}
\AxiomC{$\vdash M : A$}
\UnaryInfC{$\vdash {\bf let \: pure \:} \underline{\quad} = \underline {\quad} {\: \bf in \:} M : \Box A$}
\end{prooftree}

Тогда, если $\vdash M : A$, тогда $\vdash {\bf pure \:} M : \Box A$.

Данное рассуждение действует также и в обратную сторону.
\end{proof}

\begin{theorem}
$ $

$\twoheadrightarrow_{r}$ сильно нормализуемо;
\end{theorem}

\begin{proof}
$ $

Мы модифицируем технику Тэйта с логическими отношениями для модальностей \cite{Pierce} \cite{Troelstra}.


\begin{defin} Множества строго вычислимых термов:
$ $
\begin{itemize}
  \item $SC_A = \{ M : A \: | \: M \text{ сильно нормализуем } \}$ for $A \in \mathbb{T}$;
  \item $SC_{A \to B} = \{ M : A \to B \: | \: \forall N \in SC_A, M N \in SC_B \}$, длф $A,B \in \mathbb{T}_{\bf K}$ и $A, B \in \mathbb{T}_{{\bf K}}$;
  \item $SC_{\Box A} = \{ M : {\bf K}A \: | \: M \text{ сильно нормализуем } \}$ для атомарного типа $A$;
  \item $SC_{\Box A} = \{ M : \Box A \: | \: \forall B \in \mathbb{T}_{{\bf K}}, (N \in SC_{B} \Rightarrow {\bf let \: pure\:} x = M {\: \bf in \:} N \in SC_{\Box B}) \}$ для составного типа $A$.
\end{itemize}
\end{defin}

Заметим, что определение $SC_{\Box A}$ для составного типа $A$ в указанном виде справедливо
для терма $N$ с одной свободной переменной $x$.
Если в терме $N$ больше одной свободной переменной, тогда мы рассматриваем вектор $\langle M_1,\dots,M_n\rangle$,
каждый из элементов которого принадлежит соотвествующему множеству строго вычислимых термов,
согласованному с определением $SC_{\Box A}$ для составного типа $A$.

\begin{lemma}
$ $

  Для любого типа $A$, если $M \in SC_A$, тогда $M$ сильно нормализуем.

\end{lemma}

\begin{proof}
$ $

  Индукция по длине $A$.

1) Если $A$ атомарный и $M \in SC_A$, тогда утвержение непосредственно следует из
определения множества строго вычислимых термов. Аналогично для $M \in SC_{\Box A}$, где $A$ -- атомарный тип.

2) Пусть $M \in SC_{\Box A}$ и $N \in SC_B$, тогда ${\bf let \: pure \:} x = M {\: \bf in \:} N \in SC_{\Box B}$, который сильно нормализуем по
предположению индукции, тогда и нормализуем и $M$, в противном случае существовал бы бесконечный редукционный путь в
${\bf let \: pure \:} x = M {\: \bf in \:} N$.
\end{proof}

\begin{lemma}
$ $

  \begin{itemize}
    \item Если $M \in SC_A$, то ${\bf pure \:} M$ сильно нормализуем.
    \item Если $M$ сильно нормализуем, то ${\bf pure \:} M$ сильно нормализуем.
  \end{itemize}
\end{lemma}

\begin{proof}
$ $

  1) Индукция по длине $A$.

  2) Напрямую следует из леммы 5 и первого пункта данной леммы.
\end{proof}

\begin{lemma}
$ $

  Если $M \in SC_A$ и $M \rightarrow_{r} N$, тогда и только тогда, когда $N \in SC_A$.

\end{lemma}

\begin{proof}
$ $

  Индукция по длине $A$.

1) Пусть $A$ атомарный, тогда случаи для $SC_A$ и $SC_{\Box A}$ очевидны.

2) Пусть $M \in SC_{\Box A}$ и $N \in SC_B$ и при этом $M \rightarrow_{r} P$.

По определению $SC_{\Box A}$, ${\bf let \: pure \:} x = M {\: in \:} N \in SC_{\Box B}$.

По предположению индукции, ${\bf let \: pure \:} x = M {\: \bf in \:} N \rightarrow_{r}
{\bf let \: pure \:} x = P {\: \bf in \:} N$, тогда ${\bf let \: pure \:} x = P {\: \bf in \:} N \in SC_{\Box B}$,
откуда $P \in SC_{\Box A}$.

3) Пусть $M \in SC_A$ и $M \rightarrow_{r} N$. Тогда ${\bf pure \:} M \in SC_{\Box A}$ и
${\bf pure \:} M \rightarrow_{r} {\bf pure \:} N$, тогда $N \in SC_{\Box A}$.

Рассуждение в обратную сторону проводится симметрично.

\end{proof}

\begin{lemma}
$ $

Пусть $x_1 : A_1,\dots, x_n : A_n \vdash M : A$ и для любых $i, M_i \in SC_{A_i}$, тогда $M [x_1 := M_1,\dots,x_n := M_n] \in SC_A$.
\end{lemma}

\begin{proof}
$ $

Индукция по построению $x_1 : A_1,\dots, x_n : A_n \vdash M : A$.

1) Пусть вывод заканчивается применением правила ${\Box}_I$:

\begin{prooftree}
\AxiomC{$x_1 : A_1,\dots, x_n : A_n \vdash M : A$}
\RightLabel{${\Box}_I$}
\UnaryInfC{$x_1 : A_1,\dots, x_n : A_n \vdash {\bf pure \:} M : {\Box}A$}
\end{prooftree}

По предположению индукции $M [x_1 := M_1,\dots,x_n := M_n] \in SC_A$, тогда ${\bf pure \:} M [x_1 := M_1,\dots,x_n := M_n] \in SC_{\Box A}$.

\vspace{\baselineskip}

2) Пусть вывод заканчивается применением правила $\text{let}_{\bf K}$.
\begin{prooftree}
\AxiomC{$x_1 : A_1,\dots, x_n : A_n \vdash \vec{M^{'}} : \Box \vec{A}$}
\AxiomC{$\vec{x} : \vec{A} \vdash N : B$}
\RightLabel{$\text{let}_{\Box}$}
\BinaryInfC{$x_1 : A_1,\dots, x_n : A_n \vdash {\bf let \: pure \:} \vec{x} = \vec{M^{'}} {\: \bf in \:} N : \Box B$}
\end{prooftree}

По предположению индукции $i \in \{ 1,\dots,\text{length}(\vec{M^{'}}) \}$, $M_i^{'} [x_1 := M_1,\dots,x_n := M_n] \in SC_{\Box A_i}$.

Тогда ${\bf let \: pure \:} \vec{x} = \vec{M^{'}} [x_1 := M_1,\dots,x_n := M_n] {\: \bf in \:} N \in SC_{\Box B}$,
иначе мы имели бесконечный путь редукций в терме $\vec{M^{'}} [x_1 := M_1,\dots,x_n := M_n]$.
\end{proof}

\begin{col}

Все термы строго вычислимы, следовательно, сильно нормализуемы.
\end{col}

\end{proof}

\begin{theorem} Свойство Черча-Россера
$ $

$\twoheadrightarrow_{r}$ конфлюентно.
\end{theorem}

\begin{proof}

  По лемме Ньюмана, если отношение сильно нормализуемо и локально конфлюентно, то отношение конфлюентно.

Достаточно показать локальную конфлюентность.

\begin{lemma} Локальная конфлюентность.

Если $M \rightarrow_{r} N$ и $M \rightarrow_{r} Q$, тогда найдется такой терм $P$,
что $N \twoheadrightarrow_{r} P$ и $Q \twoheadrightarrow_{r} P$.

\end{lemma}

\begin{proof}

Рассмотрим следующий набор критических пар и покажем, что оба терма из данной пары редуцируются к одному и тому же терму:


1) \xymatrix{
{\bf let \: pure \:} x = ({\bf let \: pure \:} \vec{y} = {\bf pure \:} \vec{M} {\: \bf in \:} N) {\: \bf in \:} x \ar[dr]^{\beta \Box} \ar[d]_{\Box {\bf id}}\\
{\bf let \: pure \:} \vec{y} = {\bf pure \:} \vec{M} {\: \bf in \:} N & {\bf let \: pure \:} \vec{y} = {\bf pure \:} M {\: \bf in \:} N
}

$\begin{array}{lll}
&{\bf let \: pure \:} \vec{y} = {\bf pure \:} \vec{M} {\: \bf in \:} N \rightarrow_{\beta \Box {\bf pure}} {\bf pure \:} N [\vec{y} := \vec{M}]&
\end{array}$

\vspace{\baselineskip}

2) \xymatrix{
{\bf let \: pure \:} x = ({\bf let \: pure \:} y = {\bf pure \:} M {\: \bf in \:} y) {\: \bf in \:} N \ar[dr]^{\beta \Box} \ar[d]_{\Box {\bf id}} \\
{\bf let \: pure \:} x = {\bf pure \:} M {\: \bf in \:} N & {\bf let \: pure \:} y = {\bf pure \:} M {\: \bf in \:} N [x := y]
}

\vspace{\baselineskip}

$\begin{array}{lll}
&{\bf let \: pure \:} x = {\bf pure \:} M {\: \bf in \:} N& \\
&\quad\quad\quad\quad\quad\quad\quad \rightarrow_{\beta \Box {\bf pure}} {\bf pure \:} N [x := M]&\\
&{\bf let \: pure \:} y = {\bf pure \:} M {\: \bf in \:} N [x := y]&\\
&\quad\quad\quad\quad\quad\quad\quad \rightarrow_{\beta \Box {\bf pure}} ({\bf pure \:} N [x := y]) [y := M] \equiv {\bf pure \:} N [x := M]&
\end{array}$

3) \xymatrix{
{\bf let \: pure \:} x = ({\bf let \: pure \:} \vec{y} = {\bf pure \:} \vec{N} {\: \bf in \:} P) {\: \bf in \:} M \ar[d]_{\beta \Box} \ar[dr]^{\beta \Box {\bf pure}} \\
{\bf let \: pure \:} \vec{y} = {\bf pure \:} \vec{N} {\: \bf in \:} M [x := P] & {\bf let \: pure \:} x = {\bf pure \:} P [\vec{y} := \vec{N}] {\: \bf in \:} M
}

$\begin{array}{lll}
&{\bf let \: pure \:} \vec{y} = {\bf pure \:} \vec{N} {\: \bf in \:} M [x := P] \rightarrow_{\beta \Box {\bf pure}}& \\
&\quad\quad\quad\quad\quad\quad\quad {\bf pure \:} M [x := P] [\vec{y} = \vec{N}]& \\
&{\bf let \: pure \:} x = {\bf pure \:} P [\vec{y} := \vec{N}] {\: \bf in \:} M \rightarrow_{\beta \Box {\bf pure}}& \\
&\quad\quad\quad\quad\quad\quad\quad {\bf pure \:} M [x := P[\vec{y} := \vec{N}]]& \\
&\text{ }&\\
&\text{По лемме о подстановке}& \\
&{\bf pure \:} M [x := P] [\vec{y} = \vec{N}] \equiv {\bf pure \:} M [\vec{y} = \vec{N}] [x := P[\vec{y} := \vec{N}]]& \\
&\text{По нашему соглашению, $x \notin \vec{y}$, тогда}& \\
&M[\vec{y} = \vec{N}] [x := P[\vec{y} := \vec{N}]] \equiv M [x := P[\vec{y} := \vec{N}]]& \\
\end{array}$


\end{proof}
\end{proof}

\begin{theorem}
$ $

Нормальная форма $\lambda_{{\bf K}}$ со стратегией вычисления с вызовом по имени обладает свойством подформульности: если $M$ в нормальной форме, то всего его подтермы также в нормальной форме.

\end{theorem}

\begin{proof}
Индукция по структуре $M$.

Случай ${\bf let \: pure\:} \vec{x} = \vec{M} {\: \bf in \:} N$ рассмотрен Какутани \cite{ModalK} \cite{ModalK1}.

Пусть ${\bf pure \:} M$ в нормальной форме, тогда $M$ в нормальной форме и все его подтермы также в нормальной форме по предположению индукции.

Тогда, если ${\bf pure \:} M$ в нормальной форме, то и все его подтермы также в нормальной форме.
\end{proof}
