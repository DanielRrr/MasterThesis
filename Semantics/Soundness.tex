\documentclass[a4paper]{article}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{bussproofs}
\usepackage{mathtools}
\usepackage{verbatim}
\usepackage{dsfont}
\usepackage[all, 2cell]{xy}
\usepackage[all]{xy}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{defin}{Definition}
\newtheorem{ex}{Example}
\newtheorem{col}{Corollary}
\usepackage{listings} 		% for source code
\date{}
\title{Soundness for modal type theory based on the intuitionistic epistemic logic}

\begin{document}
\maketitle

\section{Modal lambda calculus based on IEL$^{-}$}

\begin{defin} The set of terms:

Let $\mathbb{V}$ is a set of variables. The set $\Lambda_{\textbf{K}}$ of terms is defined by the grammar:
\begin{equation}
  \Lambda_{\textbf{K}} ::= \mathbb{V} \: | \:  (\lambda \Lambda.\Lambda_{\textbf{K}}) \: | \:
  (\Lambda_{\textbf{K}}\Lambda_{\textbf{K}}) \: | \: (\Lambda_{\textbf{K}} , \Lambda_{\textbf{K}}) \: | \:
  (\pi_i \Lambda_{\textbf{K}}) \:
  | \: (pure \: \Lambda_{\textbf{K}}) \: | \: (\Lambda_{\textbf{K}} \star
  \Lambda_{\textbf{K}})
\end{equation}
where $i \in \{ 1, 2 \}$.
\end{defin}

\begin{defin} The set of types:

Let $\mathbb{T}$ is a set of atomic types. The set $\mathbb{T}_{\textbf{K}}$ of types with applicative
functor
$\textbf{K}$ is generated by the grammar:
\begin{equation}
  \mathbb{T}_{\textbf{K}} ::= \mathbb{T} \: | \: (\mathbb{T}_{\textbf{K}} \to \mathbb{T}_{\textbf{K}}) \: |
  \:
  (\mathbb{T}_{\textbf{K}} \times \mathbb{T}_{\textbf{K}}) \: | \: (\textbf{K}\mathbb{T}_{\textbf{K}})
\end{equation}
\end{defin}

Our type system is based on the Curry-style typing rules:

\begin{defin} Modal typed lambda calculus $\lambda \textbf{K}$ based on NIEL$^{-}_{\land, \to}$:

\begin{center}
\begin{prooftree}
\AxiomC{$ $}
\RightLabel{\scriptsize{ax}}
\UnaryInfC{$\Gamma , x : \alpha \vdash x : \alpha$}
\end{prooftree}
\end{center}

\begin{minipage}{0.5\textwidth}
  \begin{flushleft}
\begin{prooftree}
\AxiomC{$\Gamma, x : \alpha \vdash M : \beta$}
\RightLabel{$\rightarrow_i$}
\UnaryInfC{$\Gamma \vdash \lambda x. M : \alpha \to \beta$}
\end{prooftree}

\begin{prooftree}
\AxiomC{ $\Gamma \vdash x : \alpha$ }
\AxiomC{ $\Gamma \vdash y : \beta$ }
\RightLabel{$\times_i$}
\BinaryInfC{$\Gamma \vdash (x, y) : \alpha \times \beta$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$\Gamma, \vdash x : \alpha$}
  \RightLabel{$\textbf{K}_I$}
  \UnaryInfC{$\Gamma \vdash \text{pure } \: x : \textbf{K}\alpha $}
\end{prooftree}
  \end{flushleft}
\end{minipage}

\begin{minipage}{0.5\textwidth}
  \begin{flushright}
\begin{prooftree}
\AxiomC{$\Gamma \vdash f : \alpha \to \beta$}
\AxiomC{$\Gamma \vdash x : \alpha$}
\RightLabel{$\rightarrow_e$}
\BinaryInfC{$\Gamma \vdash fx : \beta$}
\end{prooftree}

\begin{prooftree}
\AxiomC{ $\Gamma \vdash p : \alpha_1 \times \alpha_2$ }
\RightLabel{$\times_e$, $i \in \{ 1, 2 \}$}
\UnaryInfC{$\Gamma \vdash \pi_i p : \alpha_i$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$\Gamma \vdash f : \textbf{K}(\alpha \to \beta)$}
  \AxiomC{$\Gamma \vdash x : \textbf{K}\alpha$}
  \RightLabel{$\textbf{K}_{app}$}
  \BinaryInfC{$\Gamma \vdash f \star x : \textbf{K}\beta$}
\end{prooftree}
  \end{flushright}
\end{minipage}
\end{defin}

\begin{defin} $\beta$-reduction rules:

1) $(\lambda x. M) N \rightarrow_{\beta} M [x := N]$;

2) $\pi_i \langle M_1, M_2 \rangle \rightarrow_{\beta} M_i, i \in \{ 1,2 \}$;

3) $\text{pure } (\lambda x. x) \star M \rightarrow_{\beta} M$;

4) $\text{pure } (\lambda f g x. f (g x)) \star M \star N \star P \rightarrow_{\beta} M \star (N \star P)$;

5) $(\text{pure } M) \star (\text{pure } N) \rightarrow_{\beta} \text{pure } (M N)$;

6) $M \star \text{pure } N \rightarrow_{\beta} (\lambda f. f N) \star M$;
\end{defin}

\begin{defin} $\eta$-reduction rules for applicative functor:

1) $\text{pure } (\lambda x. f x) \rightarrow_{\eta} \text{pure } f$;

2) $\text{pure } \langle \pi_1 p, \pi_2 p \rangle \rightarrow_{\eta} \text{pure } p$;

3) $\lambda x. f \star x \rightarrow_{\eta} f$.
\end{defin}


\section{Categorical model.}
Let us define monoidal categories and strong lax monoidal functors.

\begin{defin} Monoidal category.

A monoidal category $\mathcal{C}$ is a category with:

1) A bifunctor $\otimes : \mathcal{C} \times \mathcal{C} \to \mathcal{C}$ called the tensor product;

2) An object $\mathds{1} \in Ob(\mathcal{C})$ called the unit;

3) A natural isomorphism such that for all $A, B, C \in Ob(\mathcal{C})$:

\xymatrix{
  &&&& \alpha_{A, B, C} :  (A \otimes B)  \otimes C \ar[rr]^{\cong}  &&A \otimes (B \otimes C)}

where $\alpha$ is called associator.

4) A natural isomorphism (left unitor) for all $A \in Ob(\mathcal{C})$:

\xymatrix{
 &&&& L_A : (\mathds{1} \otimes A) \ar[rr]^{\cong} && A
}

5) A natural isomorphism (right unitor) for all $A \in Ob(\mathcal{C})$:

\xymatrix{
 &&&& R_A : (A \otimes \mathds{1}) \ar[rr]^{\cong} && A}

\vspace{\baselineskip}

6) The next one diagram commutes (the triangle identity):

\vspace{\baselineskip}

\xymatrix{
&&&& A \otimes B &&&&\\
&&&(A \otimes \mathds{1}) \otimes B \ar[rr]_{\alpha_{A, \mathds{1}, B}} \ar[ur]^{R_{A} \otimes id_{B}} && A \otimes (\mathds{1} \otimes B \ar[ul]_{id_{A} \otimes L_{B}})
}

\vspace{\baselineskip}

7) The next one diagram commutes too (the pentagon identity):

\vspace{\baselineskip}

\xymatrix{
&& (A \otimes B) \otimes (C \otimes D) \ar[dr]^{\alpha_{A, B, C \otimes D}}&& \\
&((A \otimes B) \otimes C) \otimes D \ar[ur]^{\alpha_{A \otimes B, C, D}}  \ar[dd]_{\alpha_{A,B,C}  \otimes
id_{D}}&& A \otimes (B \otimes (C \otimes D)) \\
\\
& (A \otimes (B \otimes C)) \otimes D \ar[rr]_{\alpha_{A, B \otimes C, D}} && A \otimes ((B \otimes C)
\otimes D) \ar[uu]_{id_{A} \otimes \alpha_{B, C, D}}
}

\vspace{\baselineskip}

A monoidal category is symmetrical iff $\forall A, B \in Ob(\mathcal{C}), A \otimes B \cong B \otimes
A$.
\end{defin}

\vspace{\baselineskip}

\begin{defin}
A lax monoidal functor between monoinal categories $\langle \mathcal{C}, \otimes, \mathds{1} \rangle$
and $\langle \mathcal{D}, \otimes', \mathds{1} \rangle$ is a functor $F : \langle \mathcal{C}, \otimes,
\mathds{1} \rangle \to \langle \mathcal{D}, \otimes', \mathds{1} \rangle$ with the next natural
transformations:

1) $u : \mathds{1} \to F \mathds{1}$ (unit property);

2) $\ast : F A \otimes' F B \to F (A \otimes B)$ (application property);

and with the next commuting diagrams:

\vspace{\baselineskip}

\xymatrix{
&&&& \mathds{1} \otimes' F A \ar[rr]_{L_{F A}} \ar[d]_{u \otimes id_{F A}} && F A \\
&&&& F \mathds{1} \otimes' F A \ar[rr]_{\ast} && F (\mathds{1} \otimes A) \ar[u]_{F L}
}

\xymatrix{
&&&& F A \otimes' \mathds{1}\ar[rr]_{R_{F A}} \ar[d]_{id_{F A} \otimes u} && F A \\
&&&& F A \otimes' F \mathds{1} \ar[rr]_{\ast} && F (A \otimes \mathds{1}) \ar[u]_{F R}
}

\xymatrix{
&& F A \otimes' F (B \otimes C) \ar[dr]^{\ast} &&\\
& F A \otimes' (F B \otimes' F C) \ar[dd]_{\alpha_{F A, F B, F C}} \ar[ur]^{id_{F A} \otimes \ast }&& F (A
\otimes (B \otimes C)) \ar[dd]^{F \alpha_{A, B, C} }\\
\\
& (F A \otimes' F B) \otimes' F C \ar[dr]_{\ast \otimes id_{F C}} && F ((A \otimes B) \otimes C)\\
&& F (A \otimes B) \otimes' F C \ar[ur]_{\ast}&&
}
\end{defin}

\begin{defin} Applicative functor.

Let $\langle \mathcal{C}, \otimes, \mathds{1} \rangle$ is a symmetrcial monoidal category. Applicative
functor is an endofunctor $F : \langle \mathcal{C}, \otimes, \mathds{1}\rangle \to \langle \mathcal{C},
\otimes, \mathds{1}\rangle$ with a natural transformation $p: Id_{\mathcal{C}} \Rightarrow F$ with the next
properties:

1) A natural transformation $p$ is defined as follows for all $A \in Ob(\mathcal{C})$ the following
diagram commutes:

\xymatrix{
&&&&& A \ar[dd]_{p_A}\ar[rr]^{f}&& B \ar[dd]^{p_B}\\
\\
&&&&& F A \ar[rr]_{F f} && F B
}

2) $p_{\mathds{1}} = u$:

\xymatrix{
&&&&& \mathds{1} \ar[dd]_{p_{\mathds{1}}}\ar[rr]^{id_{\mathds{1}}}&& \mathds{1} \ar[dd]^{u}\\
\\
&&&&& F \mathds{1} \ar[rr]_{id_{F \mathds{1}}} && F \mathds{1}
}

3) $p \circ \ast = \ast \circ (p \otimes p)$;

4) The following diagram commutes (weak commutativity condition):
\vspace{\baselineskip}
\begin{center}
\xymatrix{
&&&& F A \otimes F B \ar[dr]^{\ast} &&&&\\
&&& A \otimes F B \ar[dd]_{swap_{A, F B}} \ar[ur]^{p_A \otimes id_{F B}}&& F (A \otimes B) \ar[dd]^{F
(swap_{A, B})}\\
\\
&&& F B \otimes A \ar[dr]_{id_{F B} \otimes p_A} && F (B \otimes A)\\
&&&& F B \otimes F A \ar[ur]_{\ast}&&&
}
\end{center}
\end{defin}

\section{Soundness}

\begin{defin} Semantical translation from $\lambda_{\textbf{K}}$ to CCC with applicative functor:

1) Interpretation for types: $[\![A]\!] := \hat{A}, A \in \mathbb{T}$, $[\![A \to B]\!] := [\![A]\!]
\to [\![B]\!]$, $[\![A \times B]\!] := [\![A]\!] \times [\![B]\!]$;

2) Interpretation for modal types: $[\![\textbf{K}A]\!] = \mathcal{K}[\![A]\!]$, where $\mathcal{K}$ is
an applicative functor;

3) Interpretaion for contexts: $[\![\Gamma = \{ x_1 : A_1, ..., x_n : A_n\}]\!] := [\![\Gamma]\!] =
[\![A_1]\!] \times ... \times [\![A_n]\!]$;

4) Interpretation for typing assignment: $[\![\Gamma \vdash M : A]\!] := [\![M]\!] : [\![\Gamma]\!] \to
[\![A]\!]$, where $[\![M]\!] : [\![\Gamma]\!] \to [\![A]\!] \in \mathcal{C}$;

5) Interpretation for typing rules:

\begin{prooftree}
\AxiomC{$ $}
\UnaryInfC{$[\![\Gamma, x : A \vdash x : A]\!] := \pi_2 : [\![\Gamma]\!] \times [\![A]\!] \rightarrow
[\![A]\!]$}
\end{prooftree}

\begin{prooftree}
\AxiomC{$[\![\Gamma, x : A \vdash M : B]\!] := f : [\![\Gamma]\!] \times [\![A]\!] \rightarrow [\![B]\!]$}
\UnaryInfC{$[\![\Gamma \vdash (\lambda x. M) : A \to B]\!] := \Lambda(f) : [\![\Gamma]\!]
\rightarrow[\![B]\!]^{[\![A]\!]}$}
\end{prooftree}

\begin{prooftree}
\AxiomC{$[\![\Gamma \vdash M : A \to B]\!] := [\![M]\!] : [\![\Gamma]\!] \rightarrow [\![B]\!]^{[\![A]\!]}$}
\AxiomC{$[\![\Gamma \vdash N : A]\!] := [\![N]\!] : [\![\Gamma]\!] \rightarrow [\![A]\!]$}
\BinaryInfC{$[\![\Gamma \vdash (M N) : B]\!] := [\![\Gamma]\!] \xrightarrow{\langle [\![M]\!], [\![N]\!]
\rangle} [\![B]\!]^{[\![A]\!]} \times [\![A]\!] \xrightarrow{\epsilon} [\![B]\!] $}
\end{prooftree}

\begin{prooftree}
\AxiomC{$[\![\Gamma \vdash M : A ]\!] := f : [\![\Gamma]\!] \rightarrow [\![A]\!]$}
\AxiomC{$[\![\Gamma \vdash N : B ]\!] := g : [\![\Gamma]\!] \rightarrow [\![B]\!]$}
\BinaryInfC{$[\![\Gamma \vdash (M, N) : A \times B]\!] := \langle f, g \rangle : [\![\Gamma]\!] \rightarrow
[\![A]\!] \times [\![B]\!]$}
\end{prooftree}

\begin{prooftree}
\AxiomC{$[\![\Gamma \vdash p : A_1 \times A_2]\!] := f : [\![\Gamma]\!] \rightarrow [\![A_1]\!] \times
[\![A_2]\!]$}
\RightLabel{$i \in \{1,2\}$}
\UnaryInfC{$[\![\Gamma \vdash \pi_i p : A_i]\!] := [\![\Gamma]\!] \xrightarrow{f} [\![A_1]\!] \times
[\![A_2]\!] \xrightarrow{\pi_i} [\![A_i]\!]$}
\end{prooftree}

\begin{prooftree}
\AxiomC{$[\![\Gamma \vdash M : A]\!] := [\![M]\!] : [\![\Gamma]\!] \rightarrow [\![A]\!]$}
\UnaryInfC{$[\![\Gamma \vdash \text{pure } M : \textbf{K}A]\!] := [\![\Gamma]\!] \xrightarrow{[\![M]\!]}
[\![A]\!] \xrightarrow{p_A} \mathcal{K}[\![A]\!]$}
\end{prooftree}

\begin{prooftree}
\AxiomC{$[\![\Gamma \vdash M : \textbf{K}(A \to B)]\!] := [\![M]\!] : [\![\Gamma]\!] \rightarrow
\mathcal{K}([\![B]\!]^{[\![A]\!]})$}
\AxiomC{$[\![\Gamma \vdash N : \textbf{K}A ]\!] := [\![N]\!] : [\![\Gamma]\!] \rightarrow
\mathcal{K}[\![A]\!]$}
\BinaryInfC{$[\![\Gamma \vdash M \star N : \textbf{K}B ]\!] := [\![\Gamma]\!]
\xrightarrow{\mathcal{K}(\epsilon_{A,B}) \circ \cong \circ \langle [\![M]\!], [\![N]\!] \rangle}
\mathcal{K}B$}
\end{prooftree}

\end{defin}

\begin{defin} Simultaneous substitution

Let $\Gamma = \{ x_1 : A_1, ..., x_n : A_n \}$, $\Gamma \vdash M : A$ and for all $i \in \{ 1,..., n \}$,
$\Gamma \vdash M_i : A_i$.

We define simultaneous substitution $M [ \vec{x} := \vec{M}]$ recursively by:

1) $x_i [ \vec{x} := \vec{M}] := M_i $;

2) $(\lambda x. M) [ \vec{x} := \vec{M}] := \lambda x. (M [ \vec{x} := \vec{M}])$;

3) $(M N) [ \vec{x} := \vec{M}] = (M [ \vec{x} := \vec{M}]) (N [ \vec{x} := \vec{M}])$;

4) $\langle M, N \rangle = \langle (M [ \vec{x} := \vec{M}]), (N [ \vec{x} := \vec{M}])\rangle$;

5) $(\pi_i P) [ \vec{x} := \vec{M}] = \pi_i (P [ \vec{x} := \vec{M}])$;

6) $(\text{pure } M) [ \vec{x} := \vec{M}] = \text{pure } (M [ \vec{x} := \vec{M}])$;

7) $(M \star N) [ \vec{x} := \vec{M}] = (M [ \vec{x} := \vec{M}])
\star (N [ \vec{x} := \vec{M}])$.

\end{defin}

\begin{lemma}
$ $

$[\![M [x_1 := M_1,\dots, x_n := M_n]]\!] = [\![M]\!] \circ \langle [\![M_1]\!], \dots, [\![M_n]\!] \rangle$.

\end{lemma}

\begin{proof}

$ $

1) $[\![(\text{pure } M) [ \vec{x} := \vec{M}]]\!] = [\![\text{pure } M]\!] \circ \langle [\![M_1]\!], \dots,
[\![M_n]\!] \rangle$.

\vspace{\baselineskip}

$\begin{array}{lll}
& [\![(\text{pure } M) [ \vec{x} := \vec{M}]]\!] = [\![\text{pure } (M [ \vec{x} := \vec{M}])]\!] &
\text{Substitution definition} \\
& \quad\quad\quad\quad\quad\quad\quad = p \circ [\![(M [ \vec{x} := \vec{M}])]\!]&
\text{Translation for pure}\\
& \quad\quad\quad\quad\quad\quad\quad = p \circ [\![M]\!] \circ \langle [\![M_1]\!], \dots,
[\![M_n]\!] \rangle & \text{Induction hypothesis} \\
& \quad\quad\quad\quad\quad\quad\quad = (p \circ [\![M]\!]) \circ \langle [\![M_1]\!], \dots,
[\![M_n]\!] \rangle & \text{Associativity of composition}\\
& \quad\quad\quad\quad\quad\quad\quad = [\![\text{pure } M]\!] \circ \langle [\![M_1]\!], \dots,
[\![M_n]\!] \rangle& \text{Translation for pure}\\
\end{array}$

\vspace{\baselineskip}

2) $[\![(M \star N) [ \vec{x} := \vec{M}] \!] = [\![M \star N]\!] \circ \langle [\![M_1]\!], \dots,
[\![M_n]\!] \rangle$.

\vspace{\baselineskip}

$\begin{array}{lll}
& [\![(M \star N) [ \vec{x} := \vec{M}] \!] = [\![(M [\vec{x} := \vec{M}]) \star (N [ \vec{x} := \vec{M}])]\!]& \text{Definition of substitution} \\
&\quad = p_{\epsilon} \circ \ast \circ \langle [\![(M [\vec{x} := \vec{M}])]\!], [(N [\vec{x} := \vec{M}])]\!] \rangle & \text{Translation for $\star$} \\
&\quad = p_{\epsilon} \circ \ast \circ \langle [\![M]\!] \circ \langle [\![M_1]\!], \dots,
[\![M_n]\!] \rangle, [\![N]\!] \circ \langle [\![M_1]\!], \dots,
[\![M_n]\!] \rangle\rangle & \text{Induction hypothesis} \\
&\quad = p_{\epsilon} \circ \ast \circ \langle  [\![M]\!], [\![N]\!] \rangle \circ \langle [\![M_1]\!], \dots,
[\![M_n]\!] \rangle& \text{Property of morphism product} \\
&\quad = (p_{\epsilon} \circ \ast \circ \langle  [\![M]\!], [\![N]\!]) \rangle \circ \langle [\![M_1]\!],
\dots, [\![M_n]\!] \rangle& \text{Associativity of composition} \\
&\quad = [\![M \star N]\!] \circ \langle [\![M_1]\!], \dots, [\![M_n]\!] \rangle& \text{Translation for $
\star$}
\end{array}$

\end{proof}

\begin{lemma}

$ $

If $M \rightarrow_{\beta} N$, then $[\![M]\!] = [\![N]\!]$.

\end{lemma}

1) $[\![\text{pure } (\lambda x. x) \star M]\!] = [\![M]\!]$;

\vspace{\baselineskip}

\begin{prooftree}
\AxiomC{$[\![x : A \vdash x : A]\!] = \pi_2 : \mathds{1} \times [\![A]\!] \to [\![A]\!]$}
\UnaryInfC{$[\![\vdash \lambda x. x : A \to A]\!] = \Lambda(\pi_2) : \mathds{1} \to [\![A]\!]^{[\![A]\!]}$}
\UnaryInfC{$[\![\vdash \text{pure } (\lambda x. x) : \textbf{K}(A \to A)]\!] = p_{[\![A]\!]^{[\![A]\!]}} \circ \Lambda(\pi_2) : \mathds{1} \to \mathcal{K}([\![A]\!]^{[\![A]\!]})$}
\end{prooftree}

But by the following diagram:

\xymatrix{
&&&&& [\![A]\!]^{[\![A]\!]} \ar[r]^{p_{[\![A]\!]^{[\![A]\!]}}} & \mathcal{K}([\![A]\!]^{[\![A]\!]}) \\
&&&&& \mathds{1} \ar[u]^{\Lambda{\pi_2}} \ar[r]_{p_{\mathds{1} = id_{\mathds{1}}}} & \mathds{1} \ar[u]_{\mathcal{K}(\Lambda(\pi_2))}
}

$\begin{array}{lll}
&p_{[\![A]\!]^{[\![A]\!]}} \circ \Lambda(\pi_2) = id_{\mathds{1}} \circ \mathcal{K}(\Lambda(\pi_2)) & \\
&\quad\quad\quad\quad\quad\quad\quad= \mathcal{K}(\Lambda(\pi_2))&
\end{array}$

So:

$[\![\vdash \text{pure } (\lambda x. x) : \textbf{K}(A \to A)]\!] = \mathcal{K}(\Lambda(\pi_2)) :
\mathds{1} \to \mathcal{K}([\![A]\!]^{[\![A]\!]})$

$[\![M : \textbf{K}A \vdash M : \textbf{K}A]\!] = id_{\mathcal{K}A} : \mathcal{K}([\![A]\!]) \to
\mathcal{K}([\![A]\!])$, or

$[\![M : \textbf{K}A \vdash M : \textbf{K}A]\!] = \pi_2 : \mathds{1} \times \mathcal{K}([\![A]\!]) \to \mathcal{K}([\![A]\!])$.

\vspace{\baselineskip}

Let us consider the next commutative diagram:

\xymatrix{
\mathcal{K}(A^A) \times \mathcal{K}A \ar[r]^{\cong} & \mathcal{K}(A^A \times A)
\ar[r]^{\mathcal{K(\epsilon)}} & \mathcal{K}A && \mathds{1} \times \mathcal{K}A \ar[dd]_{\pi_2}
\ar[r]^{\cong} & \mathcal{K}(A^A \times A) \ar[dd]^{\mathcal{K}(\pi_2)} \\
\\
\mathds{1} \times \mathcal{K}A \ar[uu]^{\mathcal{K}(\Lambda(\pi_2)) \times id_{\mathcal{K}A}} \ar[r]_{\cong}
& \mathcal{K}(\mathds{1} \times A) \ar[uu]^{\mathcal{K}(\Lambda(\pi_2) \times id_A)}
\ar[uur]_{\mathcal{K}(\pi_2)} &&& \mathcal{K}A \ar[r]_{id_{\mathcal{K}A}} & \mathcal{K}A
}

\vspace{\baselineskip}

Hence:\\
$\begin{array}{lll}
&[\![M : \textbf{K}A \vdash \text{pure } (\lambda x. x) \star M]\!] = (\mathcal{K}(\epsilon) \circ (\cong))
\circ (\mathcal{K}(\Lambda(\pi_2)) \times
id_{\mathcal{K}A}) & \\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad = \mathcal{K}(\epsilon) \circ \mathcal{K}(\Lambda(\pi_2) \times id_A) \: \circ \: (\cong) & \\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad = \mathcal{K}(\epsilon) \circ \: (\cong)& \\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad = \pi_2 = [\![M : \textbf{K}A \vdash M : \textbf{K}A]\!]&
\end{array}$

\vspace{\baselineskip}



\vspace{\baselineskip}

\newpage

2) $[\![(\text{pure } \lambda f g x. f (g x)) \star M \star N \star P]\!] = [\![M \star (N \star P)]\!]$

The first part of equality:

\vspace{\baselineskip}

\newpage

3) $[\![(\text{pure } M) \star (\text{pure } N)]\!] = [\![\text{pure } (M N)]\!]$;

\vspace{\baselineskip}

1) The left part of the equality:

\begin{prooftree}
\AxiomC{$[\![\Gamma \vdash M : A \to B]\!] = f : [\![\Gamma]\!] \to [\![B]\!]^{\![A]\!}$}
\UnaryInfC{$[\![\Gamma \vdash \text{pure } M : \textbf{K}(A \to B)]\!] = p_{[\![B]\!]^{\![A]\!}} \circ f : [\![\Gamma]\!] \to \mathcal{K}([\![B]\!]^{\![A]\!})$}
\end{prooftree}

\begin{prooftree}
\AxiomC{$[\![\Delta \vdash N : A]\!] = g : [\![\Delta]\!] \to [\![A]\!]$}
\UnaryInfC{$[\![\Delta \vdash \text{pure } N : \textbf{K}A]\!] = p_{[\![A]\!]} \circ g : [\![\Delta]\!] \to
\mathcal{K}[\![A]\!]$}
\end{prooftree}

\begin{prooftree}
\AxiomC{$[\![\Gamma, \Delta \vdash (\text{pure } M) \star (\text{pure } N) : \textbf{K}B]\!] =
\mathcal{K}(\epsilon) \circ (\cong) \circ (p_{[\![B]\!]^{\![A]\!}} \circ f \times p_{[\![A]\!]} \circ g) :
\Gamma \times \Delta \to \mathcal{K}B$}
\end{prooftree}

\vspace{\baselineskip}

2) The second part of equality:

\begin{prooftree}
\AxiomC{$[\![\Gamma \vdash M : A \to B]\!] = f : [\![\Gamma]\!] \to [\![B]\!]^{\![A]\!}$}
\AxiomC{$[\![\Delta \vdash N : A]\!] = g : [\![\Delta]\!] \to [\![A]\!]$}
\BinaryInfC{$[\![\Gamma, \Delta \vdash M N : B]\!] = \epsilon \circ f \times g : [\![\Gamma]\!] \times
[\![\Delta]\!] \to [\![B]\!]$}
\UnaryInfC{$[\![\Gamma, \Delta \vdash \text{pure } (M N) : \textbf{K}B]\!] = p_{[\![B]\!]} \circ (\epsilon
\circ (f \times g)) : [\![\Gamma]\!] \times [\![\Delta]\!] \to \mathcal{K}[\![B]\!]$}
\end{prooftree}



\xymatrix{
&& [\![\Gamma]\!] \times [\![\Delta]\!] \ar[dd]_{f \times g} \ar[dddll]_{p_{[\![B]\!]^{\![A]\!}} \circ f \times p_{[\![A]\!]} \circ g} \ar[ddrr]^{\epsilon \circ f \times g}\\
\\
&& [\![B]\!]^{[\![A]\!]} \times [\![A]\!] \ar[rr]^{\epsilon} \ar[dll]^{\quad p_{[\![B]\!]^{\![A]\!}} \times p_{[\![A]\!]}} \ar[ddd]_{p_{[\![B]\!]^{\![A]\!} \times[\![A]\!] }} && [\![B]\!] \ar[ddd]^{p_{[\![B]\!]}} \\
\mathcal{K}([\![B]\!]^{[\![A]\!]}) \times \mathcal{K}[\![A]\!] \ar[ddrr]_{\cong}\\
\\
&& \mathcal{K}(\![B]\!]^{[\![A]\!]} \times [\![A]\!]) \ar[rr]_{\mathcal{K}(\epsilon)} && \mathcal{K}[\![B]\!]
}

\vspace{\baselineskip}

$\begin{array}{lll}
&[\![\Gamma, \Delta \vdash (\text{pure } M) \star (\text{pure } N) : \textbf{K}B]\!] =
\mathcal{K}(\epsilon) \circ (\cong) \circ (p_{[\![B]\!]^{\![A]\!}} \circ f \times p_{[\![A]\!]} \circ g) &\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad = K(\epsilon) \circ (\cong)
\circ p_{{[\![B]\!]^{[\![A]\!]}}} \times p_{[\![A]\!]} \circ f \times g& \\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad = K(\epsilon) \circ
p_{[\![B]\!]^{[\![A]\!]} \times [\![A]\!]} \circ f \times g& \\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad = p_{[\![B]\!]} \circ \epsilon \circ f \times g& \\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad = [\![\Gamma, \Delta \vdash \text{pure } (M N) : \mathcal{K}B]\!]&
\end{array}$

\vspace{\baselineskip}

\newpage

4) $\begin{array}{lll}
&[\![N : A, M : \textbf{K}(A \to B) \vdash M \star \text{pure } N : \textbf{K}B]\!] =&\\
&[\![N : A, M : \textbf{K}(A \to B) \vdash \text{pure } (\lambda f. f N) \star M : \textbf{K}B]\!]&
\end{array}$

\vspace{\baselineskip}

It is easy to see that the following diagram commutes:

\vspace{\baselineskip}

\xymatrix{
\mathcal{K}([\![B]\!]^{([\![B]\!]^{[\![A]\!]})}) \times \mathcal{K}([\![B]\!]^{[\![A]\!]})\ar[r]^{\cong} &
\mathcal{K}([\![B]\!]^{([\![B]\!]^{[\![A]\!]})} \times [\![B]\!]^{[\![A]\!]})
\ar[r]^{\quad \mathcal{K}(\epsilon)}& \mathcal{K}[\![B]\!] \\
\\
\mathcal{K}[\![A]\!] \times \mathcal{K}([\![B]\!]^{[\![A]\!]}) \ar[r]^{\cong}
\ar[uu]^{\mathcal{K}(\Lambda(\epsilon \circ
\langle \pi_2, \pi_1 \rangle)) \times id_{\mathcal{K}[\![B]\!]^{[\![A]\!]}}} & \mathcal{K}([\![A]\!] \times
[\![B]\!]^{[\![A]\!]})
\ar[r]^{\mathcal{K}(\langle \pi_2, \pi_1 \rangle)} \ar[uu]^{\mathcal{K}(\Lambda(\epsilon \circ \langle
\pi_2, \pi_1 \rangle) \times id_{[\![B]\!]^{[\![A]\!]}})} & \mathcal{K}([\![B]\!]^{[\![A]\!]} \times
[\![A]\!]) \ar[uu]_{\mathcal{K}(\epsilon)}\\
\\
[\![A]\!] \times \mathcal{K}([\![B]\!]^{[\![A]\!]}) \ar[r]_{p_{[\![A]\!]} \times
id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})}} \ar[uu]^{p_{[\![A]\!]} \times id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})}} & \mathcal{K}[\![A]\!] \times
\mathcal{K}([\![B]\!]^{[\![A]\!]}) \ar[r]_{\langle \pi_2, \pi_1 \rangle} \ar[uu]_{\cong} & \mathcal{K}([\![B]\!]^{[\![A]\!]}) \times \mathcal{K}[\![A]\!]
\ar[uu]_{\cong}
}

\vspace{\baselineskip}

$\begin{array}{lll}
&[\![N : A, M : \textbf{K}(A \to B) \vdash \text{pure } (\lambda f. f N) \star M : \textbf{K}B]\!] =&\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \text{by interpretation}&\\
&\mathcal{K}(\epsilon) \circ (\cong) \circ ((p_{[\![B]\!]^{([\![B]\!]^{[\![A]\!]})}} \circ \Lambda(\epsilon
\circ \langle \pi_2, \pi_1 \rangle)) \times id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})}) =&\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \text{by the definition of $p$}&\\
&\mathcal{K}(\epsilon) \circ (\cong) \circ
(\mathcal{K}(\Lambda(\epsilon \circ \langle \pi_2, \pi_1 \rangle)) \circ p_{[\![A]\!]}) \times
id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})} =&\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad
\text{by the definition of identity function }& \\
&\mathcal{K}(\epsilon) \circ (\cong) \circ
(\mathcal{K}(\Lambda(\epsilon \circ \langle \pi_2, \pi_1 \rangle)) \circ p_{[\![A]\!]}) \times
(id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})} \circ id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})}) =&\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \text{the property of composition of product morphisms}&\\
&\mathcal{K}(\epsilon) \circ (\cong) \circ
(\mathcal{K}(\Lambda(\epsilon \circ \langle \pi_2, \pi_1 \rangle)) \times
id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})}) \circ
(p_{[\![A]\!]} \times id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})}))= &\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \text{diagram above}&\\
&\mathcal{K}(\epsilon) \circ (\cong) \circ \langle \pi_2, \pi_1 \rangle \circ (p_{[\![A]\!]} \times
id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})}))= &\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \text{the property of product morphisms}&\\
&\mathcal{K}(\epsilon) \circ (\cong) \circ \langle \pi_2 \circ (p_{[\![A]\!]} \times
id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})}, \pi_1 \circ (p_{[\![A]\!]} \times
id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})} \rangle =& \\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \text{by unfolding the morphism product}&\\
&\mathcal{K}(\epsilon) \circ (\cong) \circ
\langle
\pi_2 \circ \langle p_{[\![A]\!]} \circ \pi_1, id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})} \circ \pi_2 \rangle,
\pi_1 \circ \langle p_{[\![A]\!]} \circ \pi_1, id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})} \circ \pi_2 \rangle
\rangle =&\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \text{by the definition of pair morphism}&\\
&\mathcal{K}(\epsilon) \circ (\cong) \circ
\langle
id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})} \circ \pi_2,
p_{[\![A]\!]} \circ \pi_1
\rangle =&\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \text{the property of product morphisms}&\\
&\mathcal{K}(\epsilon) \circ (\cong) \circ (id_{\mathcal{K}([\![B]\!]^{[\![A]\!]})} \times p_{[\![A]\!]})
\circ \langle \pi_2, \pi_1 \rangle =&\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \text{by interpretation}&\\
&[\![N : A, M : \textbf{K}(A \to B) \vdash M \star \text{pure } N : \textbf{K}B]\!]&
\end{array}$

\vspace{\baselineskip}

\begin{lemma}

If $M \rightarrow_{\eta} N$, then $[\![M]\!] = [\![N]\!]$.

\end{lemma}

\begin{proof}

$ $

1) $[\![\text{pure } (\lambda x. f x)]\!] = [\![\text{pure } f]\!]$.

\vspace{\baselineskip}

$\begin{array}{lll}
&[\![\text{pure } (\lambda x. f x)]\!] = p \circ [\![\lambda x. f x]\!]& \text{Translation for pure} \\
&\quad\quad\quad\quad\quad\quad\quad= p \circ [\![f]\!]& \text{$\eta$-reduction rule for application} \\
&\quad\quad\quad\quad\quad\quad\quad= [\![\text{pure } f ]\!]& \text{Translation for pure}
\end{array}$

\vspace{\baselineskip}

2) $[\![\text{pure } \langle \pi_1 M, \pi_2 M \rangle]\!] = [\![\text{pure } M]\!]$

\vspace{\baselineskip}

$\begin{array}{lll}
&[\![\text{pure } \langle \pi_1 M, \pi_2 M \rangle]\!] = p \circ [\![\langle \pi_1 M, \pi_2 M \rangle]\!]&
\text{Translation for pure} \\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad= p \circ [\![M]\!]& \text{$\eta$-reduction rule for pair} \\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad= [\![\text{pure } M]\!]& \text{Translation for pure}
\end{array}$
\vspace{\baselineskip}

3)

$\begin{array}{lll}
&[\![M : \textbf{K}(A \times B) \vdash \text{pure } (\lambda x. \lambda y. \langle x, y \rangle) \star
(\text{pure } (\lambda x. \pi_1) \star M) \star (\text{pure } (\lambda x. \pi_2) \star M : \textbf{K}(A
\times B)]\!]=&\\
&[\![M : \textbf{K}(A \times B) \vdash M : \textbf{K}(A \times B)]\!]&
\end{array}$

\vspace{\baselineskip}

i) The first step

Let us consider interpetation for $\vdash \text{pure } (\lambda x. \lambda y. \langle x, y \rangle) :
\textbf{K}(A \to B \to A \times B)$:
\begin{prooftree}
\AxiomC{$\pi_2 : \mathds{1} \times ([\![A]\!] \times [\![B]\!]) \rightarrow [\![A]\!] \times [\![B]\!]$}
\UnaryInfC{$\pi_2 \circ \alpha : (\mathds{1} \times [\![A]\!]) \times [\![B]\!] \rightarrow [\![A]\!] \times [\![B]\!]$}
\UnaryInfC{$\Lambda(\pi_2 \circ \alpha) : \mathds{1} \times [\![A]\!] \rightarrow [\![A]\!] \times [\![B]\!]^{[\![B]\!]}$}
\UnaryInfC{$\Lambda(\Lambda(\pi_2 \circ \alpha)): \mathds{1} \rightarrow [\![A]\!] \times
[\![B]\!]^{[\![B]\!]^{[\![A]\!]}}$}
\UnaryInfC{$p_{[\![A]\!] \times [\![B]\!]^{[\![B]\!]^{[\![A]\!]}}} \circ \Lambda(\Lambda(\pi_2 \circ
\alpha)) : \mathds{1} \rightarrow \mathcal{K}([\![A]\!] \times [\![B]\!]^{[\![B]\!]^{[\![A]\!]}})$ }
\end{prooftree}

By naturality, $p_{[\![A]\!] \times [\![B]\!]^{[\![B]\!]^{[\![A]\!]}}} \circ \Lambda(\Lambda(\pi_2 \circ
\alpha)) = \mathcal{K}(\Lambda(\Lambda(\pi_2 \circ \alpha))$.

At first let us show that the following diagram commutes in any CCC:

\vspace{\baselineskip}

\xymatrix{
([\![A \times B]\!]^{[\![B]\!]^{[\![A]\!]}} \times [\![A]\!]) \times [\![B]\!] \ar[rr]^{\quad\quad\quad\quad
\epsilon \circ (\epsilon \times id_{[\![B]\!]})} && [\![A]\!] \times [\![B]\!] \\
(\mathds[1] \times [\![A]\!]) \times [\![B]\!] \ar[u]^{(\Lambda(\Lambda(\pi_2 \circ
\alpha)) \times id_{[\![A]\!]}) \times id_{[\![B]\!]}} \ar[urr]_{\pi_2 \circ \alpha}
}

\vspace{\baselineskip}

$\begin{array}{lll}
&\epsilon \circ (\epsilon \times id_{[\![B]\!]}) \circ (\Lambda(\Lambda(\pi_2 \circ
\alpha)) \times id_{[\![A]\!]}) \times id_{[\![B]\!]} =&\\
&\text{by the definition of morphism product}&\\
&\epsilon \circ (\epsilon \times id_{[\![B]\!]}) \circ \langle \Lambda(\Lambda(\pi_2 \circ
\alpha)) \circ \pi_1, id_{[\![A]\!]} \circ \pi_2 \rangle \times id_{[\![B]\!]} = & \\
&\text{by the definition of morphism product}& \\
&\epsilon \circ (\epsilon \times id_{[\![B]\!]}) \circ \langle \langle \Lambda(\Lambda(\pi_2 \circ
\alpha)) \circ \pi_1, id_{[\![A]\!]} \circ \pi_2 \rangle \circ \pi_1, id_{[\![B]\!]} \circ \pi_2 \rangle & \\
&\text{by the property of morphism product}& \\
&\epsilon \circ \langle \epsilon \circ \langle \Lambda(\Lambda(\pi_2 \circ
\alpha)) \circ \pi_1, id_{[\![A]\!]} \circ \pi_2 \rangle \circ \pi_1, id_{[\![B]\!]} \circ id_{[\![B]\!]} \circ \pi_2 \rangle = &\\
&\text{by the definition of morphism product and by identity}& \\
&\epsilon \circ \langle \epsilon \circ (\Lambda(\Lambda(\pi_2 \circ \alpha)) \times id_{[\![A]\!]}) \circ \pi_1, id_{[\![B]\!]} \circ \pi_2 \rangle = & \\
&\text{by exponentiation and currying property}& \\
&\epsilon \circ \langle \Lambda(\pi_2 \circ \alpha) \circ \pi_1, id_{[\![B]\!]} \circ \pi_2 \rangle = & \\
&\text{by the definition of morphism product}&\\
&\epsilon \circ \Lambda(\pi_2 \circ \alpha) \times id_{[\![B]\!]} & \\
&\text{by exponentiation and currying property}& \\
&\pi_2 \circ \alpha&
\end{array}$

\vspace{\baselineskip}

2) 

\end{proof}

\begin{lemma}
$ $

1) $[\![M]\!] = [\![N]\!]$, if $[\![\text{pure }  M]\!] = [\![\text{pure } N]\!]$;

2) Let $[\![M]\!] = [\![N]\!]$, then $[\![M \star P]\!] = [\![N \star P]\!]$;

3) Let $[\![M]\!] = [\![N]\!]$, then $[\![P \star M]\!] = [\![P \star N]\!]$.
\end{lemma}

\begin{proof}

$ $

1)

i) ``only if''-part.

Let $[\![M]\!] : [\![\Gamma]\!] \to [\![A]\!]$, $[\![N]\!] : [\![\Gamma]\!] \to [\![A]\!]$ and $[\![M]\!] =
[\![N]\!]$. So $p \circ [\![M]\!] = p \circ [\![N]\!]$, hence $[\![\text{pure } M]\!] = [\![\text{pure }
N]\!]$.


\end{proof}




\end{document}
